FROM node:16-alpine 
WORKDIR /app 

# Installiere Vue CLI global für Entwicklungsumgebung
RUN npm install -g @vue/cli

# Überprüfe, ob package.json existiert und installiere Abhängigkeiten
COPY package*.json ./ 
RUN if [ -f package.json ]; then npm install; else echo "Package.json not found, creating minimal package.json" && echo '{"name":"kormit-frontend","version":"0.1.0","private":true}' > package.json && npm install; fi

# Kopiere den Rest des Projekts
COPY . . 

# Stelle sicher, dass die notwendigen Skripte definiert sind
RUN if ! grep -q "serve" package.json; then sed -i 's/"scripts": {/"scripts": {\n    "serve": "vue-cli-service serve",/g' package.json; fi

EXPOSE 8080 

# Verwende eine Shell, um bessere Fehlerbehandlung zu ermöglichen
CMD ["sh", "-c", "if command -v npm && npm run serve; then true; else echo 'Starting dev server manually' && vue-cli-service serve; fi"] 
